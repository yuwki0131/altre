# Undo/Redo 実装に関する確認事項

## Q1. 履歴の適用範囲
Undo/Redo の履歴はバッファ単位で管理すべきか、それともグローバル（全バッファ共通）で管理すべきか。分割ウィンドウで同じバッファを表示するケースや、バッファを閉じる場合の扱いも含めて方針を決めたい。

### Answer
バッファ単位で管理してください。分割ウィンドウで同じバッファを編集する場合は同一の履歴として管理。バッファを閉じた場合は、閉じた時点で履歴は破棄し、再度同一ファイルを開いた場合などは新規の履歴としてください。

## Q2. 操作のまとめ方
連続した文字入力やバックスペース操作はどの粒度で履歴に記録するべきか。一定時間やコマンド境界でまとめるのか、1 文字ずつ記録するのか、要件が不明なため決定が必要。

### Answer
粒度は、単語単位で記録(this is a pen)の場合は、this <space> is <space> a <space> penのそれぞれの単位で記録、それ以外の操作は操作単位で記録(例えば、改行、Yank、cutなどは1操作として記録)

## Q3. カーソル移動の扱い
Undo/Redo でカーソル位置も復元するか、それともテキスト変更のみ対象にするか。Emacs ではカーソル位置も巻き戻るが、MVP の scope としてどこまで再現するか確認したい。

### Answer
カーソル位置も復元としてください。MVPでもカーソル位置復元含めて必須です。

## Q4. バッファ切替・ファイル操作との関係
ファイル保存やバッファ切替、再読込などの操作を履歴に含めるか、または履歴をクリアするタイミングをどう定義するか。Undo 実行後に Save した場合の扱いも要確認。

### Answer
前述の通り、バッファ単位で記録し、ファイル保存時も保存しバッファが生きているならば継続して履歴を記録、バッファが破棄されたタイミングで履歴も履き。undo実行後に、saveした場合も、履歴は継続して保存してください。

## Q5. 履歴容量とスナップショット
履歴の上限サイズやメモリ対策は必要か。大きな挿入／削除が発生した場合のスナップショット戦略が必要かどうかの判断が欲しい。

### Answer
MVP実装時点では大きな挿入、削除に特別な戦略の考慮はなくて大丈夫です。

## Q6. 履歴構造の形態
Undo/Redo の履歴を Emacs のような木構造で保持するか、一般的なテキストエディタのように線形で管理するか確認したい。

### Answer
履歴は線形で管理してください。Undo を実行した後に新しい編集を行った場合は、それ以降の Redo 履歴は破棄される一般的な挙動を採用します。
