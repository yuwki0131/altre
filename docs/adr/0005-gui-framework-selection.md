# ADR 0005: GUIフレームワークに Slint を採用する

- **日付**: 2025-09-28
- **ステータス**: 承認済み（GUI 実装準備中）

## 背景
- altre は MVP として ratatui + crossterm による TUI を構築済みだが、中長期的には Linux (NixOS/Wayland/Hyprland を含む) を主対象とした GUI 化と、最終的な Windows / macOS への展開を計画している。
- 既存ドキュメントでは GUI には Tauri を想定していたが、Rust 側ロジック資産を活かしつつ日本語含む多言語編集に耐え、長期的に保守可能なネイティブ GUI レイヤを再検討する必要が生じた。
- 特に日本語入力 (IME) と高品質なテキスト描画、Linux Wayland 環境での挙動の確実性が重要要件である。

## 決定
- GUI 実装の中核フレームワークとして **Slint** を採用する。
- TUI 実装は並行して維持しつつ、`src/ui/` の抽象化を進め、Slint ベースの GUI レンダラーを追加する計画とする。

## 選定理由
1. **多言語対応の信頼性**: Slint は HarfBuzz ベースのテキストレイアウトを備え、CJK を含む複雑なスクリプトの描画品質が高い。IME も Qt/GTK バックエンド経由で安定しており、Wayland/Hyprland での運用実績がある。
2. **パフォーマンス**: GPU アクセラレーションを標準で利用し、60fps を超える描画を想定した設計。テキストエディタで問題となる大規模テキスト描画でも遅延が少ない。
3. **長期保守性**: Qt Company の支援を受けたプロジェクトであり、リリース頻度とロードマップが明確。Rust との統合が公式でサポートされ、商用展開も視野に入る。
4. **アーキテクチャ適合**: UI を .slint ファイルで宣言的に定義しつつ、ロジックは Rust 側の構造体・メソッドに委譲できるため、既存の buffer/input/minibuffer といったドメイン層を再利用しやすい。
5. **マルチプラットフォーム**: Wayland/X11/Windows/macOS/iOS/Android まで網羅したクロスプラットフォーム戦略が示されており、最終目標の各 OS 展開に適合する。

## 比較検討
| 候補 | 評価 |
|------|------|
| Iced | `cosmic-text` により多言語描画は改善中だが、IME は winit 依存で Wayland/Hyprland では未成熟。短期的には日本語入力が成立しないリスクが高い。 |
| gtk-rs (GTK4/Libadwaita) | Pango による多言語サポートと Wayland 安定性は抜群だが、Windows/macOS への移植時のセットアップ負荷が大きい。GObject パターンの学習コストも高い。 |
| Tauri | WebView ベースで多言語・IME はブラウザ品質だが、Rust 中心のアーキテクチャを大幅に組み替える必要がある。常駐メモリとレイテンシもネイティブより大きい。 |
| egui/eframe | 即時モードで試作は容易だが、ネイティブな IME 対応が未整備。長期保守や UI 品質の観点で Slint ほどの安心感はない。 |

## 影響
- UI レイヤを Slint 向けに抽象化するため、`src/ui/` の構造見直しと描画ロジックの分離が必要。
- ビルド環境に Slint コンパイラ (`slint-build`) を導入し、`build.rs` の追加や CI 設定変更が必要になる。
- 既存ドキュメント（README、architecture、manuals）の GUI 記述を Slint 前提に更新するタスクが発生する。
- テキストレンダリングや IME に関するテスト戦略を Slint/Wayland 環境で再設計する必要がある。

## 移行計画（概要）
1. UI 抽象化レイヤの整理 (`UiFacade` 仮称) と TUI 実装の移植。
2. Slint プロジェクトの雛形を作成し、ミニバッファ / メインエディタ / モードラインの描画試作。
3. 入力イベントとコマンド分派の橋渡しを Slint イベントループに適合させる。
4. パフォーマンス計測と IME/多言語の検証を行い、QA ドキュメントへフィードバック。
5. ドキュメント・マニュアルの更新と配布パイプライン整備。

## ステータス更新条件
- Slint ベースの最小 GUI が既存機能（テキスト編集・ファイル操作・ミニバッファ）を再現し、主要 OS での起動確認が取れた段階で「実装中」へ更新する。
- 別フレームワークへの移行を検討する場合は、本 ADR を supersede する新 ADR を作成する。
