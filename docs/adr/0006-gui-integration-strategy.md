# ADR 0006: Slint GUI 統合戦略

- **日付**: 2025-09-28
- **ステータス**: 承認済み（GUI 実装準備中）

## 背景
- ADR 0005 で GUI フレームワークとして Slint を採用する方針を決定した。
- TUI 実装に依存した現行構造を見直し、Slint ベース GUI を並行提供するための設計判断が必要となった。
- QA の議論で合意された実装方針を正式な決定事項として記録し、今後のタスク分割と設計作業の指針とする。

## 決定
1. UI レイヤをバックエンド（ドメイン）とフロントエンド（レンダラー）に明確分離し、`ui/tui` と `ui/gui` を独立モジュールとして管理する。
2. イベントループは既存の Rust アプリケーション側で駆動し、状態更新後に Slint へ描画を通知する。
3. Crossterm 依存の入力処理は TUI フロントエンド専用モジュールとして分離し、GUI 実装から排除する。
4. `.slint` ファイルは `slint::include_slint!` マクロで組み込み、ビルド手順をシンプルに保つ。
5. テーマやレイアウトは各レンダラー固有に管理し、GUI 側の自由度を確保する。
6. 文字幅補正や UTF-8 処理は Rust 側で保持し、外部ライブラリ依存を最小化する。
7. 配布は当面ソースコード配布（`cargo run`）とし、TUI/GUI は同一バイナリで提供。デフォルトは GUI 起動、`--tui` オプションで TUI に切り替える。

## フォローアップタスク
- Slint に必要な追加依存ライブラリを最小構成で洗い出すための調査タスクを実施する（NixOS・他 OS 向けセットアップ方針の明確化）。
- 日本語 IME の検証手法（自動テスト／手動チェック）の調査タスクを実施し、結果に基づき QA を更新する。
- TUI/GUI 分離後も回帰が無いことを確認するため、既存テストと追加テストの整理を行う。

## 影響
- `src/` 配下のモジュール構成見直し（バックエンド／フロントエンド分離）が必要。
- ビルドスクリプトは不要だが、`slint::include_slint!` を利用するためのビルド依存追加と `.slint` ファイル管理ルールを策定する。
- CLI インターフェースを拡張し、GUI/TUI 切り替えオプションを実装する必要がある。
- ドキュメント（README、manuals、architecture）を新方針に合わせて更新するタスクが派生する。
