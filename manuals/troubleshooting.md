# altre トラブルシューティングガイド

## 1. 起動時の問題
### 1-1. `Failed to enter raw mode` が表示される
- **原因**: 端末エミュレータが raw mode に対応していない、他プロセスが端末を占有している。
- **対処**:
  - 別のターミナル（Alacritty、WezTerm、GNOME Terminal など）を試す。
  - `tmux` / `screen` を利用している場合はプレフィックス後に `cd app && cargo run --offline` を再実行。
  - `stty sane` で端末状態を初期化してから再起動。

### 1-2. 画面が真っ白のままフリーズする
- **原因**: `cargo run` が release ビルドでない場合、デバッグビルドの描画性能が不足することがあります。
- **対処**: `cd app && cargo run --release --offline` で起動し直し、または端末のフォントサイズを縮小。

## 2. ファイル操作に関する問題
### 2-1. `保存しました` が表示されない
- **原因**: 変更が検知されていない場合、`C-x C-s` は「変更なし」を表示します。
- **対処**: 変更済みかどうかモードラインの `[Modified]` 表記を確認。

### 2-2. `保存エラー: Permission denied` が表示される
- **原因**: 保存先ディレクトリに書き込み権限がない。
- **対処**:
  - `ls -ld <directory>` で権限を確認。
  - 書き込み可能なパスを指定して `write-file` で保存。
  - 必要に応じて `chmod` や `sudo chown` を実行。

### 2-3. `パス展開エラー` が発生する
- **原因**: `~` や相対パスの展開に失敗。
- **対処**: 実在する絶対パスを入力。パスにスペースを含める場合はクォートせずそのまま入力可能です。

### 2-4. ファイルが UTF-8 で開けない
- **原因**: altre は UTF-8 を前提としています。
- **対処**: `iconv -f SHIFT_JIS -t UTF-8 input.txt > output.txt` などで変換後に読み込む。

## 3. ミニバッファ関連の問題
### 3-1. `M-x` や `M-:` が反応しない
- **原因**: Alt キーが Meta として送出されていない。
- **対処**: `Esc` を押してから `x` / `:` を入力する（`Esc` キーは Meta のプリフィックスとして扱われます）。

### 3-2. 補完候補が多すぎて見切れる
- **原因**: ミニバッファの補完リストは最大 10 行まで表示するため、それ以上の候補はスクロールされません。
- **対処**: さらに文字を入力して候補を絞り込み、必要に応じてファイル名の先頭を入力し直す。

### 3-3. エラーメッセージがすぐ消えてしまう
- **仕様**: エラーメッセージは 5 秒で自動的に消去されます。
- **対処**: メッセージが消えた後に再度コマンドを実行するか、必要に応じて `C-g` でミニバッファをキャンセルしてやり直してください。

## 4. パフォーマンスに関する問題
### 4-1. 長大ファイルでスクロールが重い
- **原因**: MVP 版ではギャップバッファの性能調整が進行中です。
- **対処**: `cd app && cargo run --release --offline` を利用し、`cargo bench --offline` で性能を確認。巨大ファイルは分割して編集することを推奨。

### 4-2. 端末サイズ変更時にレイアウトが崩れる
- **原因**: 一部の端末ではリサイズイベント後の再描画が間に合わない場合があります。
- **対処**: 数フレーム待っても崩れが解消しない場合は `C-l` で再配置するか、必要に応じて altre を再起動してください。

## 5. ログと診断
- altre のデバッグログは現在ターミナル出力に直接書き込まれます。必要に応じて `ALTRE_DEBUG=1 cargo run` や `DEBUG.md` を参照して手元で確認してください。
- 重大な問題が発生した場合は、再現手順とログを `tasks/` ディレクトリの該当タスクにメモしておきます。

## 6. サポート窓口
- 外部向けのサポート窓口はありません。疑問点や不具合は `QA.md` または関連タスクに自分用メモとして記録してください。

---
このドキュメントは MVP 時点の既知問題を基に作成しています。最新の既知問題は `QA.md` と `CHANGELOG.md` を合わせて確認してください。
