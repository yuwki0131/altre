# ギャップバッファ設計

## タスク概要
MVPで使用するギャップバッファの詳細設計を行う。

## 目的
- 効率的なテキスト編集操作を実現するギャップバッファの実装仕様策定
- UTF-8文字列に対応した安全な操作の保証
- 将来のロープ/ピーステーブルへの移行を考慮した抽象化設計

## 設計対象
1. **ギャップバッファ構造**
   - メモリレイアウト設計
   - ギャップサイズの初期値・拡張戦略
   - UTF-8文字境界の考慮

2. **基本操作API**
   - 文字挿入・削除
   - カーソル移動
   - 範囲取得・置換

3. **パフォーマンス特性**
   - 操作の計算量
   - メモリ使用量の最適化
   - リアロケーション戦略

4. **エラーハンドリング**
   - 不正なUTF-8シーケンス処理
   - バウンダリチェック
   - メモリ不足時の動作

## 成果物
- `docs/design/gap_buffer.md` - 設計仕様書
- `src/buffer/gap_buffer.rs` - インターフェース定義
- プロパティベーステスト仕様

## QA要確認事項
- ギャップサイズの初期値（README.mdでは「設計段階で考慮」）
- 大きなファイル（数MB）での性能要件
- メモリ使用量の上限設定

## 完了条件
- [x] ギャップバッファ仕様の文書化（`docs/design/gap_buffer.md:1` に仕様書を記載）
- [x] 公開API の確定（`src/buffer/gap_buffer.rs:1` で `GapBuffer` API を定義）
- [x] テスト戦略の策定（`docs/design/gap_buffer_property_tests.md:1` と `tests/gap_buffer_prop.rs:1` を整備）
- [x] パフォーマンス目標の設定（`docs/design/performance_tests_spec.md:1` に閾値を明記）

## ステータス
- 既存実装は `src/buffer/operations.rs:1` まで連携済みであり、ギャップバッファ周辺の API は安定化。
- ベンチマークは `benches/gap_buffer.rs:1` で運用中。次の改善はロープ実装検討タスクまで保留。

## 見積もり
**期間**: 2-3日
**優先度**: 高（コア機能）

## 関連タスク
- 01_architecture_design.md（前提）
- buffer_implementation.md（実装タスク）

## 技術的考慮事項
- Rustの所有権システムとの親和性
- proptestによる不変条件テスト
- UTF-8文字境界での安全な操作保証
- 将来のテキストストレージ抽象化への対応
