# ギャップバッファ実装

## タスク概要
設計仕様に基づいてギャップバッファの実装を完成させる。

## 目的
- 効率的なテキスト編集操作を実現するギャップバッファの完全実装
- UTF-8文字列に対応した安全な操作の実装
- プロパティベーステストによる品質保証

## 実装対象
1. **コア機能の実装**
   - 基本操作（挿入・削除・移動）の完成
   - UTF-8安全性の保証
   - エラーハンドリングの実装

2. **最適化機能**
   - 文字境界キャッシュの実装
   - ギャップ拡張戦略の最適化
   - メモリ効率の改善

3. **テストの実装**
   - ユニットテストの充実
   - プロパティベーステストの実装
   - ベンチマークテストの追加

4. **統合とドキュメント**
   - モジュール構造の整理
   - APIドキュメントの完成
   - 使用例の追加

## 成果物
- `src/buffer/gap_buffer.rs` - 完全実装
- `src/buffer/mod.rs` - モジュール定義
- プロパティテストの実装
- ベンチマークテスト

## 前提条件
- 02_gap_buffer_design.mdの完了
- QA.mdの未決定事項への回答

## 完了条件
- [x] 全API機能の実装完了
- [x] 文字境界キャッシュの実装
- [x] UTF-8安全性の保証
- [x] エラーハンドリングの実装
- [ ] ユニットテストのパス
- [x] プロパティテストの実装
- [x] ベンチマークテストの実装
- [x] ドキュメントの完成

## 実施内容メモ
- `GapBuffer` を刷新し、プレフィックス/サフィックスベースで UTF-8 を扱う API を整備
- 文字境界キャッシュと行開始位置キャッシュを実装し、操作後は無効化するよう更新
- 削除/置換処理をバイト範囲操作へ置き換え、ギャップ拡張戦略を定数化
- `line_start_positions` など補助 API を追加し、単体テストと proptest を拡充
- `benches/gap_buffer.rs` にベンチマークを作成し、性能計測の足掛かりを用意
- `cargo test --offline` は依存取得制限により未実行（`aho-corasick` 取得不可）

## 見積もり
**期間**: 3-4日
**優先度**: 高（コア機能）

## 関連タスク
- 02_gap_buffer_design.md（前提）
- buffer_module_integration.md（後続）

## 技術的考慮事項
- QA.mdの回答に基づく性能目標（カーソル移動 < 1ms）
- システムメモリの動的制限によるメモリ管理
- proptestによる不変条件の検証
- 既存のerror.rsとの統合

## 実装優先順位
1. 基本API の完成とテスト
2. UTF-8安全性の実装
3. エラーハンドリングの統合
4. 最適化機能の実装
5. プロパティテストの実装
