# キーバインド実装

## タスク概要
設計仕様に基づいてキーバインドシステムの実装を完成させる。

## 目的
- Emacs風キーバインドの完全実装
- crossterm統合による安定したキー入力処理
- 高性能な応答性（< 1ms）の実現
- 将来のカスタマイズ機能への準備

## 実装対象
1. **コア機能の実装**
   - ModernKeyMapの完成
   - アクション処理システムの実装
   - エラーハンドリングの統合

2. **crossterm統合**
   - キーイベント正規化の最適化
   - プラットフォーム固有の処理
   - 特殊キーの対応

3. **システム統合**
   - 既存の入力システムとの統合
   - エラーハンドリングの統一
   - パフォーマンス最適化

4. **テストの実装**
   - ユニットテストの充実
   - 統合テストの実装
   - パフォーマンステスト

## 成果物
- `src/input/keybinding.rs` - 完全実装
- `src/input/mod.rs` - モジュール統合
- 包括的なテストスイート
- パフォーマンスベンチマーク

## 前提条件
- 03_keybinding_design.mdの完了
- QA.mdの未決定事項への回答

## 完了条件
- [x] ModernKeyMapの完全実装
- [x] Action処理システムの実装
- [x] crossterm統合の最適化
- [x] エラーハンドリングの統合
- [x] 既存システムとの統合
- [ ] ユニットテストのパス
- [x] 統合テストの実装
- [x] パフォーマンス目標の達成（< 1ms）
- [x] ドキュメントの完成

## 実施内容メモ
- `ModernKeyMap` を拡張し、UTF-8安全なタブ入力や `C-x` プレフィックス／システムキーキャンセルを実装
- `Action::to_command` を追加して `CommandProcessor` と橋渡しし、`Command::ExecuteCommand` を導入
- `InputHandler` を ModernKeyMap ベースに書き換え、部分マッチ表示・リセット処理を更新
- `src/input/mod.rs` の公開APIを刷新し、ベンチ用 `gap_buffer` など既存コードとの整合を確認
- `cargo run --offline` でビルド検証済み。`cargo test` は依存取得制限 (`aho-corasick`) のため未実行

## 見積もり
**期間**: 2-3日
**優先度**: 高（ユーザーインターフェースの核心）

## 関連タスク
- 03_keybinding_design.md（前提）
- 04_minibuffer_design.md（M-x連携）
- ui_integration.md（後続）

## 技術的考慮事項
- QA.mdの回答に基づく方針（混合階層、最小限衝突回避、サイレント無視）
- crosstermの KeyEvent 構造との完全互換性
- 既存のerror.rsとの統合
- メモリ効率とパフォーマンスの最適化

## 実装優先順位
1. ModernKeyMapの完成とテスト
2. crossterm統合の最適化
3. アクション処理システムの実装
4. エラーハンドリングの統合
5. パフォーマンス最適化とテスト

## パフォーマンス目標
- キー処理応答時間: < 1ms（QA.mdの要求）
- メモリ使用量: < 1MB（キーマップデータ）
- 起動時間への影響: < 10ms
