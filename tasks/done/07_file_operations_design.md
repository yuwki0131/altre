# ファイル操作設計

## タスク概要
MVPで実装するファイル操作（オープン、保存、新規作成）の詳細設計を行う。

## 目的
- Emacsスタイルのファイル操作インターフェース設計
- UTF-8エンコーディングとLF改行コードの統一対応
- ミニバッファとの統合設計
- エラーハンドリングの詳細仕様策定
- パス補完機能の設計

## 設計対象
1. **ファイルオープン操作**
   - `C-x C-f` (find-file) インターフェース
   - ファイルパス補完システム
   - 相対パス・絶対パス対応
   - 新規ファイル作成フロー
   - ディレクトリ表示・ナビゲーション

2. **ファイル保存操作**
   - `C-x C-s` (save-buffer) 機能
   - 変更検出・保存確認
   - バックアップファイル戦略
   - 権限エラー対応
   - アトミック保存の実装

3. **ファイル管理**
   - バッファとファイルの関連付け
   - ファイル変更状態の追跡
   - メタデータ管理（変更時刻、権限等）
   - パス正規化と検証

4. **エンコーディング・改行コード**
   - UTF-8エンコーディング強制
   - LF改行コード統一
   - 不正な文字・改行コードの処理
   - ファイル読み込み時の検証

## 成果物
- `docs/design/file_operations.md` - ファイル操作設計書
- `src/file/mod.rs` - ファイル操作インターフェース定義
- `src/file/path_completion.rs` - パス補完システム
- エラー処理フロー図

## QA確認事項
- バックアップファイル作成方針（~suffix、.bak等）
- 大きなファイル（数MB）の読み込み時間制限
- シンボリックリンクファイルの対応範囲
- 権限不足ファイルの読み取り専用モード対応
- 同時編集検出・警告機能の必要性

## 完了条件
- [x] ファイルオープンフローの設計完成
- [x] ファイル保存フローの設計完成
- [x] パス補完システムの仕様策定
- [x] エラーハンドリング方針の確定
- [x] UTF-8/LF強制仕様の策定

## 完了日時
2025-01-28 完了

## 実装成果物
- `docs/design/file_operations.md` - 詳細設計書（完成）
- `src/file/metadata.rs` - ファイルメタデータ管理（新規作成）
- 既存のfile/operations.rs, completion.rs, io.rs, path.rsは設計仕様との整合性確認済み

## 追加実装タスク
設計作業の結果、以下の実装タスクが必要と判明：
1. `06_file_operations_implementation.md` - 実装作業（既存todoリスト内）

## 見積もり
**期間**: 2-3日
**優先度**: 高（MVP必須機能）

## 関連タスク
- 04_minibuffer_design.md（ミニバッファ統合）
- 06_error_handling_design.md（エラー処理）
- 06_file_operations_implementation.md（実装）

## 技術的考慮事項
- std::fs とstd::path の活用
- shellexpand によるパス展開
- ファイルロック機能（将来対応）
- 非同期ファイルI/O（将来対応）
- メモリマップファイル（大きなファイル対応）