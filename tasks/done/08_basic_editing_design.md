# 基本編集設計

## タスク概要
MVPで実装する基本編集機能（テキスト入力、削除、改行）の詳細設計を行う。

## 目的
- ギャップバッファと統合したテキスト編集操作の設計
- 文字入力・削除・改行処理の詳細仕様策定
- UTF-8文字境界を考慮した安全な編集操作
- エディタ状態管理との統合設計
- パフォーマンス要件（< 1ms応答性）の実現方法

## 設計対象
1. **テキスト入力システム**
   - 文字入力処理（通常文字、特殊文字）
   - 日本語入力（IME）との統合考慮
   - 入力バリデーション（制御文字等）
   - 入力バッファリング戦略

2. **削除操作設計**
   - Backspace削除（カーソル前削除）
   - Delete削除（カーソル後削除）
   - UTF-8文字境界での安全な削除
   - 複合文字（結合文字）対応考慮

3. **改行処理設計**
   - Enter キーによる改行挿入
   - LF統一ポリシーの実装
   - 自動インデント（MVP対象外だが考慮）
   - 行終端処理

4. **カーソル状態管理**
   - カーソル位置の追跡・更新
   - ギャップバッファとの位置同期
   - 表示位置とバッファ位置の変換
   - 境界値処理（ファイル先頭・末尾）

5. **編集操作の統合**
   - アンドゥ・リドゥ準備（基本設計のみ）
   - 変更通知システム
   - リアルタイム表示更新
   - エラーハンドリング統合

## 成果物
- `docs/design/basic_editing.md` - 基本編集設計書
- `app/src/buffer/editor.rs` - エディタ操作インターフェース設計
- UTF-8安全な編集操作の仕様書
- パフォーマンステスト仕様

## QA確認事項
- IME統合の詳細レベル（MVP範囲）
- 複合文字対応の必要性
- 改行時の自動処理範囲
- エラー時の復旧戦略

## 完了条件
- [ ] テキスト入力システム設計完成
- [ ] 削除操作の詳細仕様策定
- [ ] 改行処理フロー設計
- [ ] カーソル管理システム設計
- [ ] UTF-8安全性保証の仕様確定
- [ ] パフォーマンス要件の実現方法確定

## 見積もり
**期間**: 2-3日
**優先度**: 高（MVP コア機能）

## 関連タスク
- 02_gap_buffer_design.md（前提）
- 03_keybinding_design.md（入力処理連携）
- 05_tui_layout_design.md（表示更新連携）
- 03_basic_editing_implementation.md（後続実装）

## 技術的考慮事項
- QA.mdの性能要求（カーソル移動 < 1ms）
- UTF-8文字境界での安全な操作
- ギャップバッファの効率的活用
- crossterm入力イベントとの統合
- メモリ効率とリアルタイム性のバランス