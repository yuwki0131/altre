# ナビゲーション設計

## タスク概要
MVPで実装するナビゲーション機能（矢印キー、Emacs風移動）の詳細設計を行う。

## 目的
- Emacs風キーバインドによるカーソル移動の設計
- 矢印キーとEmacs風キーの統合
- ギャップバッファでの効率的な位置計算
- 画面スクロール・表示領域管理との統合
- 高速応答性（< 1ms）の実現

## 設計対象
1. **基本移動操作**
   - 矢印キー（↑↓←→）による移動
   - Emacs風移動キー
     - `C-n` / `C-p`（上下移動）
     - `C-f` / `C-b`（左右移動）
   - 移動コマンドの統一インターフェース

2. **位置計算システム**
   - ギャップバッファ内での位置管理
   - 論理位置↔物理位置変換
   - UTF-8文字境界での正確な移動
   - 行・列座標系の管理

3. **行移動の詳細設計**
   - 上下移動時の列位置保持
   - 短い行での列位置調整
   - ファイル境界での停止処理
   - 改行文字の扱い

4. **文字移動の詳細設計**
   - 左右移動でのUTF-8文字単位移動
   - 複合文字（結合文字）の考慮
   - 行境界での折り返し処理
   - Tab文字の表示幅考慮

5. **画面表示との統合**
   - カーソル位置の画面同期
   - スクロール処理との連携
   - 表示領域外移動時の自動スクロール
   - 画面更新の最適化

6. **境界処理・エラーハンドリング**
   - ファイル先頭・末尾での処理
   - 空ファイルでの移動
   - 不正な位置指定の処理
   - エラー状態からの復旧

## 成果物
- `docs/design/navigation.md` - ナビゲーション設計書
- `app/src/buffer/navigation.rs` - ナビゲーション操作設計
- 位置計算アルゴリズム仕様
- パフォーマンステスト仕様

## QA確認事項
- 複合文字対応の詳細レベル
- Tab文字の表示幅設定（4スペース？8スペース？）
- 長い行でのパフォーマンス対応
- 画面外移動時のスクロール方針

## 完了条件
- [ ] 基本移動操作の設計完成
- [ ] 位置計算システム設計
- [ ] 行移動の詳細仕様策定
- [ ] 文字移動の詳細仕様策定
- [ ] 画面表示統合設計
- [ ] 境界処理・エラーハンドリング設計
- [ ] パフォーマンス要件実現方法確定

## 見積もり
**期間**: 2-3日
**優先度**: 高（MVP コア機能）

## 関連タスク
- 02_gap_buffer_design.md（位置管理基盤）
- 03_keybinding_design.md（移動キー処理）
- 05_tui_layout_design.md（画面表示連携）
- 08_basic_editing_design.md（編集操作との統合）

## 技術的考慮事項
- QA.mdの性能要求（カーソル移動 < 1ms）
- UTF-8文字境界での正確な移動
- ギャップバッファでの効率的な位置計算
- ratatui座標系との統合
- メモリ使用量とパフォーマンスのバランス
- 日本語（CJK）文字幅対応（QA Q15: 基本対応）