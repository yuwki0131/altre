# Undo/Redo 機能実装

## タスク概要
設計タスクで定義した線形 Undo/Redo をエディタへ実装し、`C-/` で Undo、`C-.` で Redo を実行できるようにする。

## 目的
- 編集操作の巻き戻し・やり直しを可能にし、ユーザーの操作安全性を向上させる
- 主要編集コマンドと履歴管理を統合し、安定した動作を実現する

## 実装対象
1. **履歴管理モジュール**
   - 履歴データ構造の実装（スタック / ノード）
   - Undo/Redo 実行ロジック
   - 履歴サイズ管理（必要に応じて上限設定）

2. **編集コマンドとの連携**
   - `CommandProcessor` / `TextEditor` での履歴記録ポイント挿入
   - 連続入力のまとめ処理（設計内容に従う）

3. **キーバインドと UI**
   - `C-/` に Undo、`C-.` に Redo を割り当て
   - ミニバッファへのメッセージ表示（成功/失敗）
   - 履歴が存在しない場合のガード

4. **テスト**
   - 単体テスト（挿入/削除/ペーストを含む Undo/Redo）
   - 結合テスト（複数コマンドを跨いだ履歴確認）
   - 回帰テスト（既存コマンドへの影響確認）

## 成果物
- `app/src/buffer` / `app/src/editor` / `app/src/input` への実装コード
- 必要に応じた `docs/design/undo_redo.md` の更新
- 新規または更新されたテストコード

## 完了条件
- [x] Undo (`C-/`) と Redo (`C-.`) が動作し、主要編集操作で正しく履歴が反映される
- [x] バッファ切替時に履歴が乱れない
- [x] 主要ケースに対するテストが追加または更新されている
- [x] QA.md の不明点が解消済み、またはフォローアップタスクが作成されている

## 見積もり
**期間**: 3 日
**優先度**: 高

## 依存関係
- 10_undo_redo_design.md（設計タスク）

## 進捗メモ
- `app/src/editor/history/` に履歴スタックとレコーダーを実装し、線形 Undo/Redo を管理。
- `App` に履歴管理を統合し、編集コマンド実行時にヒストリーを記録。`C-/` / `C-.`（環境によっては `C-7` / `C-_`）のキーバインドを追加。
- バッファごとに履歴を保持できるよう `App` / `OpenBuffer` を拡張し、バッファ切替や保存時に履歴を同期。
- `QA.md` の論点を全て解消し、Undo/Redo 仕様（線形履歴、バッファ単位管理など）を明文化。
- `docs/design/undo_redo.md` を追加して履歴モデルと適用フローを文書化。
- `cargo test`（`app/`）で既存テストを実行し、全テストが成功。
